---
export const prerender = true;

import { getCollection } from 'astro:content';
import Base from '@layouts/Base.astro';
import Hero from '@components/Hero.astro';
import SvgGenerator from '@components/SvgGenerator.astro';
import Card from '@components/Card.astro';
import BreadcrumbSchema from '@components/BreadcrumbSchema.astro';
import ItemListSchema from '@components/ItemListSchema.astro';

const baseURL = import.meta.env.BASE_URL;
const siteUrl = 'https://davids-place-portfolio.web.app';
const currentUrl = `${siteUrl}${baseURL}cookbook/`;
const allCookbookRecipes = await getCollection('cookbook');

const pageTitle = 'Vegan & Dairy-Free Recipes | Cookbook';
const pageDescription =
  'Browse 15+ vegan and dairy-free recipes including Chinese, Thai, Indian, and American classics. Easy-to-follow instructions for every skill level.';
const heroTitle = 'Cookbook: Vegan & Dairy-Free Recipes';
const heroDescription =
  'Browse my collection of plant-based recipes gathered over the years. All recipes are dairy-free with many vegan options.';
const backgroundSvgs = [
  'general/circle-scatter-haikei-1',
  'general/circle-scatter-haikei-2',
  'general/circle-scatter-haikei-3',
  'general/circle-scatter-haikei-4',
  'general/circle-scatter-haikei-5',
  'general/circle-scatter-haikei-6',
  'general/circle-scatter-haikei-7',
];
---

<Base title={pageTitle} description={pageDescription}>
  <div id="hero" class="dark:bg-medium relative overflow-hidden bg-light">
    <Hero
      title={heroTitle}
      description={heroDescription}
      isCentered={false}
      classes="relative z-10"
    />
    {
      backgroundSvgs.map((svg) => (
        <SvgGenerator
          svg={svg}
          className="absolute top-0 right-0 bottom-0 left-0 min-h-full min-w-full max-h-none max-w-none z-0 hidden"
        />
      ))
    }
  </div>

  <span class="block pb-8"></span>

  <section class="container">
    <ul class="tablet:grid-cols-2 laptop:grid-cols-4 grid grid-cols-1 gap-8">
      {
        allCookbookRecipes.map((recipe) => (
          <Card
            href={`${baseURL}cookbook/recipes/${recipe.id}/`}
            title={recipe.data.title}
            body={recipe.data.description}
            tags={recipe.data.tags}
          />
        ))
      }
    </ul>

    <span class="block pb-[200px]"></span>
  </section>

  <BreadcrumbSchema
    items={[
      { name: 'Home', url: `${siteUrl}${baseURL}` },
      { name: 'Cookbook', url: currentUrl },
    ]}
  />

  <ItemListSchema
    name="Davidâ€™s Place Cookbook Recipes"
    description="A collection of vegan and dairy-free recipes from various cuisines"
    url={currentUrl}
    items={allCookbookRecipes.map((recipe) => ({
      name: recipe.data.title,
      url: `${siteUrl}${baseURL}cookbook/recipes/${recipe.id}/`,
      description: recipe.data.description,
      image: recipe.data.image?.url?.src
        ? `${siteUrl}${recipe.data.image.url.src}`
        : undefined,
    }))}
  />
</Base>

<script>
  function initializeRandomBackground() {
    // Randomly show hero background SVG
    const hero = document.getElementById('hero');
    const backgroundSvgs = hero?.querySelectorAll('svg.absolute');

    if (backgroundSvgs?.length) {
      const randomIndex = Math.floor(Math.random() * backgroundSvgs.length);
      backgroundSvgs[randomIndex].classList.remove('hidden');
    }
  }

  initializeRandomBackground();
</script>
